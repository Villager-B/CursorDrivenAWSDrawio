# Amazon Managed Workflows for Apache Airflow (MWAA) - パブリックモードアーキテクチャ

このアーキテクチャ図は、Amazon Managed Workflows for Apache Airflow (MWAA) をパブリックモードで実装した場合の構成を示しています。

## アーキテクチャの概要

Amazon MWAAは、Apache Airflowのマネージドサービスであり、ワークフローの作成、スケジューリング、モニタリングを容易に行うことができます。パブリックモードでは、Apache Airflow UIへのアクセスがインターネット経由で可能になります。

## 主要コンポーネント

### ネットワーク構成
- **VPC**: MWAAを実行するための仮想プライベートクラウド
- **2つのアベイラビリティゾーン**: 高可用性を確保するために2つのAZにリソースを配置
- **パブリックサブネット (各AZに1つ)**: インターネットゲートウェイへのルートを持つサブネット
- **プライベートサブネット (各AZに1つ)**: MWAAワーカーが実行されるサブネット
- **NAT Gateway (各パブリックサブネットに1つ)**: プライベートサブネットからのアウトバウンドトラフィックを可能にする
- **Internet Gateway**: インターネットとVPC間の通信を可能にする

### MWAA関連コンポーネント
- **MWAA Environment (パブリックモード)**: Apache Airflowを実行するマネージド環境
- **MWAA Workers**: Apache Airflowのタスクを実行するワーカーノード
- **Aurora PostgreSQL**: Apache Airflowのメタデータを保存するデータベース
- **S3 Bucket**: DAGファイル、plugins.zip、requirements.txtを保存するバケット
- **CloudWatch**: ログとメトリクスのモニタリング
- **IAM (実行ロール)**: MWAAが他のAWSサービスにアクセスするための権限を定義

## パブリックモードの特徴

パブリックモードでは、以下の特徴があります：

1. **Apache Airflow UIへのパブリックアクセス**: インターネット経由でApache Airflow UIにアクセス可能
2. **セキュリティ**: IAMポリシーによるアクセス制御（AmazonMWAAWebServerAccess）
3. **VPCエンドポイント**: Aurora PostgreSQLメタデータデータベース用のVPCインターフェースエンドポイントが作成される
4. **ネットワークトラフィック**: Webサーバーへのトラフィックはインターネット経由でルーティングされる

## セキュリティ考慮事項

パブリックモードでMWAAを実装する際の主なセキュリティ考慮事項：

1. **IAMポリシー**: 適切なIAMポリシーを使用して、Apache Airflow UIへのアクセスを制限
2. **セキュリティグループ**: 自己参照インバウンドルールとアウトバウンドルールを適切に設定
3. **S3バケット設定**: パブリックアクセスをブロックし、バージョニングを有効化
4. **暗号化**: 保存データと転送中のデータの暗号化を確保

## 運用上の考慮事項

1. **スケーリング**: ワークロードに応じてMWAA環境のサイズを適切に設定
2. **モニタリング**: CloudWatchを使用してログとメトリクスを監視
3. **依存関係管理**: requirements.txtを使用してPython依存関係を管理
4. **カスタムプラグイン**: plugins.zipを使用してカスタムプラグインを追加

## AWS Well-Architected Frameworkの適用

このアーキテクチャは、AWS Well-Architected Frameworkの以下の柱に準拠しています：

1. **運用上の優秀性**: マネージドサービスを使用して運用オーバーヘッドを削減
2. **セキュリティ**: IAMポリシーとセキュリティグループによるアクセス制御
3. **信頼性**: 複数のアベイラビリティゾーンにわたる高可用性設計
4. **パフォーマンス効率**: マネージドサービスによる効率的なリソース使用
5. **コスト最適化**: 使用したリソースに対してのみ支払い
6. **持続可能性**: マネージドサービスによる効率的なリソース使用

## まとめ

このアーキテクチャは、Apache Airflowを使用したワークフロー管理を簡素化し、インターネット経由でのアクセスを可能にするパブリックモードでのMWAA実装を示しています。適切なセキュリティ対策と運用プラクティスを適用することで、安全で効率的なワークフロー管理環境を構築できます。 